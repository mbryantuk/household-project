services:
  totem-app:
    build: 
      context: .
      dockerfile: Dockerfile # Use the unified Dockerfile we just created
    container_name: totem-app
    ports:
      - "4001:4001"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    volumes:
      # Map the host data folder to the container's data folder
      - /home/matt/household-project/server/data:/app/server/data
    restart: always
    environment:
      - NODE_ENV=production

# You can keep the volume definition, though the bind mount above 
# handles the actual persistence on your Pi's disk.
volumes:
  totem_db_data:
