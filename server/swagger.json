{
  "openapi": "3.0.0",
  "info": {
    "title": "Totem Household SaaS API",
    "version": "3.0.0-alpha.1",
    "description": "Multi-tenant household management API with strict data isolation and RBAC. Admins have full rights, Members have object CRUD except for household management, and Viewers are read-only.",
    "contact": {
      "name": "SaaS Architect"
    }
  },
  "servers": [
    { "url": "http://localhost:4001" }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    },
    "schemas": {
      "Household": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "name": { "type": "string" },
          "address_street": { "type": "string" },
          "address_city": { "type": "string" },
          "address_zip": { "type": "string" },
          "currency": { "type": "string" },
          "date_format": { "type": "string" }
        }
      },
      "Meal": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "name": { "type": "string" },
          "description": { "type": "string" },
          "emoji": { "type": "string" }
        }
      },
      "MealPlan": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "date": { "type": "string", "format": "date" },
          "member_id": { "type": "integer" },
          "meal_id": { "type": "integer" },
          "type": { "type": "string", "enum": ["breakfast", "lunch", "dinner"] },
          "notes": { "type": "string" }
        }
      },
      "RecurringCharge": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "name": { "type": "string" },
          "amount": { "type": "number" },
          "segment": { "type": "string", "enum": ["household_bill", "insurance", "warranty", "subscription", "utility", "other", "vehicle_tax", "vehicle_mot", "vehicle_service", "vehicle_fuel"] },
          "frequency": { "type": "string", "enum": ["weekly", "monthly", "quarterly", "yearly", "one_off"] },
          "day_of_month": { "type": "integer" },
          "month_of_year": { "type": "integer" },
          "day_of_week": { "type": "integer" },
          "exact_date": { "type": "string", "format": "date" },
          "adjust_for_working_day": { "type": "integer" },
          "linked_entity_type": { "type": "string" },
          "linked_entity_id": { "type": "integer" },
          "notes": { "type": "string" },
          "is_active": { "type": "integer" }
        }
      },
      "Vehicle": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "make": { "type": "string" },
          "model": { "type": "string" },
          "registration": { "type": "string" },
          "purchase_value": { "type": "number" },
          "mot_due": { "type": "string", "format": "date" }
        }
      }
    }
  },
  "security": [{ "bearerAuth": [] }],
  "paths": {
    "/auth/register": {
      "post": {
        "summary": "Register new user and first household",
        "tags": ["Auth"],
        "requestBody": {
          "content": { "application/json": { "schema": { "type": "object", "required": ["email", "password", "householdName"], "properties": { "email": { "type": "string" }, "password": { "type": "string" }, "householdName": { "type": "string" } } } } }
        },
        "responses": { "201": { "description": "Created" } }
      }
    },
    "/auth/login": {
      "post": {
        "summary": "Login",
        "tags": ["Auth"],
        "requestBody": {
          "content": { "application/json": { "schema": { "type": "object", "required": ["password"], "properties": { "email": { "type": "string" }, "username": { "type": "string" }, "password": { "type": "string" } } } } },
          "responses": { "200": { "description": "OK" } }
        }
      }
    },
    "/households": {
      "post": {
        "summary": "Create a new household",
        "tags": ["Households"],
        "description": "Any authenticated user can create a new household. They become Admin of that household.",
        "requestBody": { "content": { "application/json": { "schema": { "type": "object", "required": ["name"], "properties": { "name": { "type": "string" } } } } } },
        "responses": { "201": { "description": "Created" } }
      }
    },
    "/households/{id}": {
      "get": {
        "summary": "Get household details",
        "tags": ["Households"],
        "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
        "responses": { "200": { "description": "OK" } }
      },
      "put": {
        "summary": "Update household details",
        "tags": ["Households"],
        "description": "Only Admin can update.",
        "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
        "responses": { "200": { "description": "Updated" } }
      },
      "delete": {
        "summary": "Delete household and all its data",
        "tags": ["Households"],
        "description": "Only Admin can delete.",
        "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }],
        "responses": { "200": { "description": "Deleted" } }
      }
    },
    "/households/{id}/finance/income": {
      "get": { "summary": "List income sources", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "OK" } } },
      "post": { "summary": "Create income source", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "201": { "description": "Created" } } }
    },
    "/households/{id}/finance/income/{itemId}": {
      "put": { "summary": "Update income source", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }, { "in": "path", "name": "itemId", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "Updated" } } },
      "delete": { "summary": "Delete income source", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }, { "in": "path", "name": "itemId", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "Deleted" } } }
    },
    "/households/{id}/finance/charges": {
      "get": { "summary": "List recurring charges", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "OK", "content": { "application/json": { "schema": { "type": "array", "items": { "$ref": "#/components/schemas/RecurringCharge" } } } } } },
      "post": { "summary": "Create recurring charge", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "requestBody": { "content": { "application/json": { "schema": { "$ref": "#/components/schemas/RecurringCharge" } } } }, "responses": { "201": { "description": "Created" } } }
    },
    "/households/{id}/finance/charges/{chargeId}": {
      "put": { "summary": "Update recurring charge", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }, { "in": "path", "name": "chargeId", "required": true, "schema": { "type": "integer" } }], "requestBody": { "content": { "application/json": { "schema": { "$ref": "#/components/schemas/RecurringCharge" } } } }, "responses": { "200": { "description": "Updated" } } },
      "delete": { "summary": "Delete recurring charge", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }, { "in": "path", "name": "chargeId", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "Deleted" } } }
    },
    "/households/{id}/finance/savings": {
      "get": { "summary": "List savings accounts", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "OK" } } },
      "post": { "summary": "Create savings account", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "201": { "description": "Created" } } }
    },
    "/households/{id}/finance/savings/{itemId}": {
      "put": { "summary": "Update savings account", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }, { "in": "path", "name": "itemId", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "Updated" } } },
      "delete": { "summary": "Delete savings account", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }, { "in": "path", "name": "itemId", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "Deleted" } } }
    },
    "/households/{id}/finance/savings/{savingsId}/pots": {
      "get": { "summary": "List savings pots", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }, { "in": "path", "name": "savingsId", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "OK" } } },
      "post": { "summary": "Create savings pot", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }, { "in": "path", "name": "savingsId", "required": true, "schema": { "type": "integer" } }], "responses": { "201": { "description": "Created" } } }
    },
    "/households/{id}/finance/credit-cards": {
      "get": { "summary": "List credit cards", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "OK" } } },
      "post": { "summary": "Create credit card", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "201": { "description": "Created" } } }
    },
    "/households/{id}/finance/credit-cards/{itemId}": {
      "put": { "summary": "Update credit card", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }, { "in": "path", "name": "itemId", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "Updated" } } },
      "delete": { "summary": "Delete credit card", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }, { "in": "path", "name": "itemId", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "Deleted" } } }
    },
    "/households/{id}/finance/loans": {
      "get": { "summary": "List loans", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "OK" } } },
      "post": { "summary": "Create loan", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "201": { "description": "Created" } } }
    },
    "/households/{id}/finance/loans/{itemId}": {
      "put": { "summary": "Update loan", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }, { "in": "path", "name": "itemId", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "Updated" } } },
      "delete": { "summary": "Delete loan", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }, { "in": "path", "name": "itemId", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "Deleted" } } }
    },
    "/households/{id}/finance/mortgages": {
      "get": { "summary": "List mortgages", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "OK" } } },
      "post": { "summary": "Create mortgage", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "201": { "description": "Created" } } }
    },
    "/households/{id}/finance/mortgages/{itemId}": {
      "put": { "summary": "Update mortgage", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }, { "in": "path", "name": "itemId", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "Updated" } } },
      "delete": { "summary": "Delete mortgage", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }, { "in": "path", "name": "itemId", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "Deleted" } } }
    },
     "/households/{id}/finance/pensions": {
      "get": { "summary": "List pensions", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "OK" } } },
      "post": { "summary": "Create pension", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "201": { "description": "Created" } } }
    },
    "/households/{id}/finance/pensions/{itemId}": {
      "put": { "summary": "Update pension", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }, { "in": "path", "name": "itemId", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "Updated" } } },
      "delete": { "summary": "Delete pension", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }, { "in": "path", "name": "itemId", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "Deleted" } } }
    },
    "/households/{id}/finance/investments": {
      "get": { "summary": "List investments", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "OK" } } },
      "post": { "summary": "Create investment", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "201": { "description": "Created" } } }
    },
    "/households/{id}/finance/investments/{itemId}": {
      "put": { "summary": "Update investment", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }, { "in": "path", "name": "itemId", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "Updated" } } },
      "delete": { "summary": "Delete investment", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }, { "in": "path", "name": "itemId", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "Deleted" } } }
    },
    "/households/{id}/finance/current-accounts": {
      "get": { "summary": "List current accounts", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "OK" } } },
      "post": { "summary": "Create current account", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "201": { "description": "Created" } } }
    },
    "/households/{id}/finance/current-accounts/{itemId}": {
      "put": { "summary": "Update current account", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }, { "in": "path", "name": "itemId", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "Updated" } } },
      "delete": { "summary": "Delete current account", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }, { "in": "path", "name": "itemId", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "Deleted" } } }
    },
    "/households/{id}/finance/assignments": {
      "get": { "summary": "List assignments", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }, { "in": "query", "name": "entity_type", "schema": { "type": "string" } }, { "in": "query", "name": "entity_id", "schema": { "type": "integer" } }, { "in": "query", "name": "member_id", "schema": { "type": "integer" } }], "responses": { "200": { "description": "OK" } } },
      "post": { "summary": "Assign member to entity", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "201": { "description": "Assigned" } } }
    },
    "/households/{id}/finance/assignments/{entity_type}/{entity_id}/{member_id}": {
      "delete": { "summary": "Unassign member from entity", "tags": ["Finance"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }, { "in": "path", "name": "entity_type", "required": true, "schema": { "type": "string" } }, { "in": "path", "name": "entity_id", "required": true, "schema": { "type": "integer" } }, { "in": "path", "name": "member_id", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "Unassigned" } } }
    },
    "/households/{id}/meals": {
      "get": { "summary": "List meals", "tags": ["Meals"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "OK" } } },
      "post": { "summary": "Create meal", "tags": ["Meals"], "description": "Admin/Member", "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "201": { "description": "Created" } } }
    },
    "/households/{id}/meal-plans": {
      "get": { "summary": "Get meal plans (optional range)", "tags": ["Meals"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }, { "in": "query", "name": "start", "schema": { "type": "string", "format": "date" } }, { "in": "query", "name": "end", "schema": { "type": "string", "format": "date" } }], "responses": { "200": { "description": "OK" } } },
      "post": { "summary": "Assign meal to plan", "tags": ["Meals"], "description": "Admin/Member", "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "201": { "description": "Assigned" } } }
    },
    "/households/{id}/vehicles": {
      "get": { "summary": "List vehicles", "tags": ["Assets"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "OK" } } },
      "post": { "summary": "Create vehicle", "tags": ["Assets"], "description": "Admin/Member", "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "201": { "description": "Created" } } }
    },
    "/households/{id}/details": {
      "get": { "summary": "Get house details", "tags": ["Details"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "OK" } } },
      "put": { "summary": "Update house details", "tags": ["Details"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "Updated" } } }
    },
    "/households/{id}/water": {
      "get": { "summary": "Get water info", "tags": ["Details"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "OK" } } },
      "put": { "summary": "Update water info", "tags": ["Details"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "Updated" } } }
    },
    "/households/{id}/council": {
      "get": { "summary": "Get council info", "tags": ["Details"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "OK" } } },
      "put": { "summary": "Update council info", "tags": ["Details"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "Updated" } } }
    },
    "/households/{id}/waste": {
      "get": { "summary": "List waste collections", "tags": ["Details"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "OK" } } },
      "post": { "summary": "Create waste collection", "tags": ["Details"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }], "responses": { "201": { "description": "Created" } } }
    },
    "/households/{id}/waste/{itemId}": {
      "put": { "summary": "Update waste collection", "tags": ["Details"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }, { "in": "path", "name": "itemId", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "Updated" } } },
      "delete": { "summary": "Delete waste collection", "tags": ["Details"], "parameters": [{ "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }, { "in": "path", "name": "itemId", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "Deleted" } } }
    },
    "/admin/backups": {
      "get": { "summary": "List backups", "tags": ["Admin"], "responses": { "200": { "description": "OK" } } }
    },
    "/admin/backups/trigger": {
      "post": { "summary": "Trigger backup", "tags": ["Admin"], "responses": { "200": { "description": "Backup created" } } }
    },
    "/admin/users": {
      "get": { "summary": "List users", "tags": ["Admin"], "responses": { "200": { "description": "OK" } } }
    },
    "/admin/create-user": {
      "post": { "summary": "Create user (Admin)", "tags": ["Admin"], "responses": { "200": { "description": "Created" } } }
    }
  }
}}
