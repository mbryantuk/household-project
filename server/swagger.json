{
  "openapi": "3.0.0",
  "info": {
    "title": "Hearthstone Pro API",
    "version": "3.2.395",
    "description": "Mission-critical multi-tenant household management API. Features strict physical data isolation, distributed tracing, and real-time telemetry.",
    "contact": {
      "name": "Lead Architect",
      "email": "mbryantuk@gmail.com"
    }
  },
  "servers": [
    {
      "url": "/api",
      "description": "Production API"
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "schema": "bearer",
        "bearerFormat": "JWT"
      }
    },
    "schemas": {
      "User": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "email": { "type": "string", "format": "email" },
          "first_name": { "type": "string" },
          "system_role": { "type": "string", "enum": ["admin", "user"] }
        }
      },
      "Household": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "name": { "type": "string" },
          "currency": { "type": "string", "default": "GBP" }
        }
      }
    }
  },
  "security": [{ "bearerAuth": [] }],
  "paths": {
    "/auth/register": {
      "post": {
        "tags": ["Auth"],
        "summary": "Register a new household and admin user",
        "responses": { "201": { "description": "Created" } }
      }
    },
    "/auth/login": {
      "post": {
        "tags": ["Auth"],
        "summary": "Authenticate and receive a JWT",
        "responses": { "200": { "description": "OK" } }
      }
    },
    "/auth/profile": {
      "get": {
        "tags": ["Auth"],
        "summary": "Get current user profile",
        "responses": { "200": { "description": "OK" } }
      },
      "put": {
        "tags": ["Auth"],
        "summary": "Update user profile settings",
        "responses": { "200": { "description": "OK" } }
      },
      "delete": {
        "tags": ["Auth"],
        "summary": "GDPR: Permanently delete account and associated data",
        "responses": { "200": { "description": "OK" } }
      }
    },
    "/admin/stats": {
      "get": {
        "tags": ["Admin"],
        "summary": "System-wide statistics",
        "responses": { "200": { "description": "OK" } }
      }
    },
    "/admin/heapdump": {
      "get": {
        "tags": ["Admin"],
        "summary": "Generate and download a V8 heap snapshot for profiling",
        "responses": { "200": { "description": "Binary file stream" } }
      }
    },
    "/admin/audit-logs": {
      "get": {
        "tags": ["Admin"],
        "summary": "Browse system-wide or per-household audit trails",
        "parameters": [{ "in": "query", "name": "householdId", "schema": { "type": "integer" } }],
        "responses": { "200": { "description": "OK" } }
      }
    },
    "/system/vitals": {
      "post": {
        "tags": ["System"],
        "summary": "Telemetry: Record Core Web Vitals from frontend",
        "responses": { "204": { "description": "No Content" } }
      }
    },
    "/system/holidays": {
      "get": {
        "tags": ["System"],
        "summary": "Fetch bank holidays for projection logic",
        "responses": { "200": { "description": "OK" } }
      }
    },
    "/households": {
      "get": {
        "tags": ["Households"],
        "summary": "List households the user has access to",
        "responses": { "200": { "description": "OK" } }
      },
      "post": {
        "tags": ["Households"],
        "summary": "Create a new household workspace",
        "responses": { "201": { "description": "Created" } }
      }
    },
    "/households/{id}/details": {
      "get": {
        "tags": ["Households"],
        "parameters": [
          { "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": { "200": { "description": "OK" } }
      }
    },
    "/households/{id}/finance/recurring-costs": {
      "get": {
        "tags": ["Finance"],
        "parameters": [
          { "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": { "200": { "description": "OK" } }
      },
      "post": {
        "tags": ["Finance"],
        "parameters": [
          { "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": { "201": { "description": "Created" } }
      }
    }
  }
}
